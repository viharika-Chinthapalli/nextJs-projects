import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

function flagEmojiToCountryCode(flagEmoji: string): string | null {
  const FLAG_EMOJI_MAP: Record<string, string> = {
    "ğŸ‡ºğŸ‡¸": "us",
    "ğŸ‡¬ğŸ‡§": "gb",
    "ğŸ‡ªğŸ‡¸": "es",
    "ğŸ‡«ğŸ‡·": "fr",
    "ğŸ‡©ğŸ‡ª": "de",
    "ğŸ‡®ğŸ‡¹": "it",
    "ğŸ‡¨ğŸ‡¦": "ca",
    "ğŸ‡¦ğŸ‡º": "au",
    "ğŸ‡§ğŸ‡·": "br",
    "ğŸ‡³ğŸ‡±": "nl",
    "ğŸ‡·ğŸ‡º": "ru",
    "ğŸ‡¯ğŸ‡µ": "jp",
    "ğŸ‡°ğŸ‡·": "kr",
    "ğŸ‡¨ğŸ‡³": "cn",
    "ğŸ‡®ğŸ‡³": "in",
    "ğŸ‡²ğŸ‡½": "mx",
    "ğŸ‡¦ğŸ‡·": "ar",
    "ğŸ‡¨ğŸ‡±": "cl",
    "ğŸ‡¨ğŸ‡´": "co",
    "ğŸ‡µğŸ‡ª": "pe",
    "ğŸ‡»ğŸ‡ª": "ve",
    "ğŸ‡ªğŸ‡¨": "ec",
    "ğŸ‡ºğŸ‡¾": "uy",
    "ğŸ‡µğŸ‡¾": "py",
    "ğŸ‡§ğŸ‡´": "bo",
    "ğŸ‡¬ğŸ‡¹": "gt",
    "ğŸ‡¨ğŸ‡·": "cr",
    "ğŸ‡µğŸ‡¦": "pa",
    "ğŸ‡³ğŸ‡®": "ni",
    "ğŸ‡­ğŸ‡³": "hn",
    "ğŸ‡¯ğŸ‡²": "jm",
    "ğŸ‡©ğŸ‡´": "do",
    "ğŸ‡¨ğŸ‡º": "cu",
    "ğŸ‡¸ğŸ‡ª": "se",
    "ğŸ‡³ğŸ‡´": "no",
    "ğŸ‡©ğŸ‡°": "dk",
    "ğŸ‡«ğŸ‡®": "fi",
    "ğŸ‡®ğŸ‡¸": "is",
    "ğŸ‡µğŸ‡±": "pl",
    "ğŸ‡¨ğŸ‡¿": "cz",
    "ğŸ‡¸ğŸ‡°": "sk",
    "ğŸ‡­ğŸ‡º": "hu",
    "ğŸ‡¦ğŸ‡¹": "at",
    "ğŸ‡¨ğŸ‡­": "ch",
    "ğŸ‡§ğŸ‡ª": "be",
    "ğŸ‡±ğŸ‡º": "lu",
    "ğŸ‡®ğŸ‡ª": "ie",
    "ğŸ‡µğŸ‡¹": "pt",
    "ğŸ‡¬ğŸ‡·": "gr",
    "ğŸ‡¹ğŸ‡·": "tr",
    "ğŸ‡·ğŸ‡´": "ro",
    "ğŸ‡§ğŸ‡¬": "bg",
    "ğŸ‡ºğŸ‡¦": "ua",
    "ğŸ‡§ğŸ‡¾": "by",
    "ğŸ‡±ğŸ‡¹": "lt",
    "ğŸ‡±ğŸ‡»": "lv",
    "ğŸ‡ªğŸ‡ª": "ee",
    "ğŸ‡·ğŸ‡¸": "rs",
    "ğŸ‡­ğŸ‡·": "hr",
    "ğŸ‡¸ğŸ‡®": "si",
    "ğŸ‡§ğŸ‡¦": "ba",
    "ğŸ‡²ğŸ‡°": "mk",
    "ğŸ‡¦ğŸ‡±": "al",
    "ğŸ‡²ğŸ‡ª": "me",
    "ğŸ‡½ğŸ‡°": "xk",
    "ğŸ‡²ğŸ‡©": "md",
    "ğŸ‡¬ğŸ‡ª": "ge",
    "ğŸ‡¦ğŸ‡²": "am",
    "ğŸ‡¦ğŸ‡¿": "az",
    "ğŸ‡°ğŸ‡¿": "kz",
    "ğŸ‡ºğŸ‡¿": "uz",
    "ğŸ‡°ğŸ‡¬": "kg",
    "ğŸ‡¹ğŸ‡¯": "tj",
    "ğŸ‡¹ğŸ‡²": "tm",
    "ğŸ‡²ğŸ‡³": "mn",
    "ğŸ‡¦ğŸ‡«": "af",
    "ğŸ‡µğŸ‡°": "pk",
    "ğŸ‡§ğŸ‡©": "bd",
    "ğŸ‡±ğŸ‡°": "lk",
    "ğŸ‡³ğŸ‡µ": "np",
    "ğŸ‡¹ğŸ‡­": "th",
    "ğŸ‡»ğŸ‡³": "vn",
    "ğŸ‡°ğŸ‡­": "kh",
    "ğŸ‡±ğŸ‡¦": "la",
    "ğŸ‡²ğŸ‡²": "mm",
    "ğŸ‡²ğŸ‡¾": "my",
    "ğŸ‡¸ğŸ‡¬": "sg",
    "ğŸ‡®ğŸ‡©": "id",
    "ğŸ‡µğŸ‡­": "ph",
    "ğŸ‡¹ğŸ‡¼": "tw",
    "ğŸ‡®ğŸ‡·": "ir",
    "ğŸ‡®ğŸ‡¶": "iq",
    "ğŸ‡¸ğŸ‡¾": "sy",
    "ğŸ‡¯ğŸ‡´": "jo",
    "ğŸ‡±ğŸ‡§": "lb",
    "ğŸ‡®ğŸ‡±": "il",
    "ğŸ‡¸ğŸ‡¦": "sa",
    "ğŸ‡¦ğŸ‡ª": "ae",
    "ğŸ‡¶ğŸ‡¦": "qa",
    "ğŸ‡°ğŸ‡¼": "kw",
    "ğŸ‡§ğŸ‡­": "bh",
    "ğŸ‡´ğŸ‡²": "om",
    "ğŸ‡¾ğŸ‡ª": "ye",
    "ğŸ‡ªğŸ‡¬": "eg",
    "ğŸ‡±ğŸ‡¾": "ly",
    "ğŸ‡¹ğŸ‡³": "tn",
    "ğŸ‡©ğŸ‡¿": "dz",
    "ğŸ‡²ğŸ‡¦": "ma",
    "ğŸ‡¸ğŸ‡©": "sd",
    "ğŸ‡ªğŸ‡¹": "et",
    "ğŸ‡°ğŸ‡ª": "ke",
    "ğŸ‡¹ğŸ‡¿": "tz",
    "ğŸ‡ºğŸ‡¬": "ug",
    "ğŸ‡·ğŸ‡¼": "rw",
    "ğŸ‡¿ğŸ‡¦": "za",
    "ğŸ‡³ğŸ‡¬": "ng",
    "ğŸ‡¬ğŸ‡­": "gh",
    "ğŸ‡¨ğŸ‡®": "ci",
    "ğŸ‡¸ğŸ‡³": "sn",
    "ğŸ‡²ğŸ‡±": "ml",
    "ğŸ‡§ğŸ‡«": "bf",
    "ğŸ‡³ğŸ‡ª": "ne",
    "ğŸ‡¹ğŸ‡©": "td",
    "ğŸ‡¨ğŸ‡²": "cm",
    "ğŸ‡¨ğŸ‡«": "cf",
    "ğŸ‡¿ğŸ‡¼": "zw",
    "ğŸ‡§ğŸ‡¼": "bw",
    "ğŸ‡³ğŸ‡¦": "na",
    "ğŸ‡±ğŸ‡¸": "ls",
    "ğŸ‡¸ğŸ‡¿": "sz",
    "ğŸ‡²ğŸ‡¬": "mg",
    "ğŸ‡²ğŸ‡º": "mu",
    "ğŸ‡³ğŸ‡¿": "nz",
    "ğŸ‡«ğŸ‡¯": "fj",
    "ğŸ‡µğŸ‡¬": "pg",
    "ğŸ‡¸ğŸ‡§": "sb",
    "ğŸ‡»ğŸ‡º": "vu",
    "ğŸ‡³ğŸ‡¨": "nc",
  };
  
  return FLAG_EMOJI_MAP[flagEmoji] || null;
}

const COUNTRY_CODE_MAP: Record<string, string> = {
  "afghanistan": "af",
  "albania": "al",
  "algeria": "dz",
  "argentina": "ar",
  "armenia": "am",
  "australia": "au",
  "austria": "at",
  "azerbaijan": "az",
  "bahrain": "bh",
  "bangladesh": "bd",
  "belarus": "by",
  "belgium": "be",
  "bolivia": "bo",
  "bosnia and herzegovina": "ba",
  "brazil": "br",
  "bulgaria": "bg",
  "cambodia": "kh",
  "canada": "ca",
  "chile": "cl",
  "china": "cn",
  "colombia": "co",
  "costa rica": "cr",
  "croatia": "hr",
  "cuba": "cu",
  "cyprus": "cy",
  "czech republic": "cz",
  "denmark": "dk",
  "dominican republic": "do",
  "ecuador": "ec",
  "egypt": "eg",
  "estonia": "ee",
  "ethiopia": "et",
  "finland": "fi",
  "france": "fr",
  "georgia": "ge",
  "germany": "de",
  "ghana": "gh",
  "greece": "gr",
  "guatemala": "gt",
  "honduras": "hn",
  "hungary": "hu",
  "iceland": "is",
  "india": "in",
  "indonesia": "id",
  "iran": "ir",
  "iraq": "iq",
  "ireland": "ie",
  "israel": "il",
  "italy": "it",
  "jamaica": "jm",
  "japan": "jp",
  "jordan": "jo",
  "kazakhstan": "kz",
  "kenya": "ke",
  "kuwait": "kw",
  "kyrgyzstan": "kg",
  "latvia": "lv",
  "lebanon": "lb",
  "libya": "ly",
  "lithuania": "lt",
  "luxembourg": "lu",
  "malaysia": "my",
  "mexico": "mx",
  "moldova": "md",
  "mongolia": "mn",
  "morocco": "ma",
  "nepal": "np",
  "netherlands": "nl",
  "new zealand": "nz",
  "nicaragua": "ni",
  "nigeria": "ng",
  "north korea": "kp",
  "norway": "no",
  "oman": "om",
  "pakistan": "pk",
  "panama": "pa",
  "paraguay": "py",
  "peru": "pe",
  "philippines": "ph",
  "poland": "pl",
  "portugal": "pt",
  "qatar": "qa",
  "romania": "ro",
  "russia": "ru",
  "saudi arabia": "sa",
  "serbia": "rs",
  "singapore": "sg",
  "slovakia": "sk",
  "slovenia": "si",
  "south africa": "za",
  "south korea": "kr",
  "spain": "es",
  "sri lanka": "lk",
  "sweden": "se",
  "switzerland": "ch",
  "syria": "sy",
  "taiwan": "tw",
  "tajikistan": "tj",
  "thailand": "th",
  "tunisia": "tn",
  "turkey": "tr",
  "turkmenistan": "tm",
  "ukraine": "ua",
  "united arab emirates": "ae",
  "united kingdom": "gb",
  "united states": "us",
  "uruguay": "uy",
  "uzbekistan": "uz",
  "venezuela": "ve",
  "vietnam": "vn",
  "yemen": "ye",
  "zimbabwe": "zw",
  "usa": "us",
  "uk": "gb",
  "uae": "ae",
};

const LANGUAGE_FLAG_MAP: Record<string, string> = {
  "en": "gb",
  "es": "es",
  "fr": "fr",
  "de": "de",
  "it": "it",
  "pt": "pt",
  "ru": "ru",
  "ja": "jp",
  "ko": "kr",
  "zh": "cn",
  "ar": "sa",
  "hi": "in",
  "tr": "tr",
  "pl": "pl",
  "nl": "nl",
  "sv": "se",
  "no": "no",
  "da": "dk",
  "fi": "fi",
  "el": "gr",
  "he": "il",
  "th": "th",
  "vi": "vn",
  "id": "id",
  "ms": "my",
  "tl": "ph",
  "uk": "ua",
  "bg": "bg",
  "cs": "cz",
  "sk": "sk",
  "sl": "si",
  "hr": "hr",
  "sr": "rs",
  "ro": "ro",
  "hu": "hu",
  "et": "ee",
  "lv": "lv",
  "lt": "lt",
};

export function getCountryFlagUrl(countryInput: string | { flag?: string; value?: string; label?: string }): string {
  if (typeof countryInput === 'object' && countryInput !== null) {
    if (countryInput.flag) {
      if (countryInput.flag.length > 2) {
        const emojiCode = flagEmojiToCountryCode(countryInput.flag);
        if (emojiCode) {
          return `https://flagcdn.com/w40/${emojiCode}.png`;
        }
      } else {
        return `https://flagcdn.com/w40/${countryInput.flag.toLowerCase()}.png`;
      }
    }
    const countryName = countryInput.value || countryInput.label || '';
    const code = COUNTRY_CODE_MAP[countryName.toLowerCase()];
    return code
      ? `https://flagcdn.com/w40/${code}.png`
      : `https://flagcdn.com/w40/un.png`;
  }

  const code = COUNTRY_CODE_MAP[countryInput.toLowerCase()];
  return code
    ? `https://flagcdn.com/w40/${code}.png`
    : `https://flagcdn.com/w40/un.png`;
}

export function getLanguageFlagUrl(languageInput: string | { flag?: string; value?: string; label?: string }): string {
  if (typeof languageInput === 'object' && languageInput !== null) {
    if (languageInput.flag) {
      if (languageInput.flag.length > 2) {
        const emojiCode = flagEmojiToCountryCode(languageInput.flag);
        if (emojiCode) {
          return `https://flagcdn.com/w40/${emojiCode}.png`;
        }
      } else {
        return `https://flagcdn.com/w40/${languageInput.flag.toLowerCase()}.png`;
      }
    }
    const langCode = languageInput.value || '';
    const countryCode = LANGUAGE_FLAG_MAP[langCode.toLowerCase()];
    return countryCode
      ? `https://flagcdn.com/w40/${countryCode}.png`
      : `https://flagcdn.com/w40/un.png`;
  }

  const countryCode = LANGUAGE_FLAG_MAP[languageInput.toLowerCase()];
  return countryCode
    ? `https://flagcdn.com/w40/${countryCode}.png`
    : `https://flagcdn.com/w40/un.png`;
}